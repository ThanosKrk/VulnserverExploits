from boofuzz import *
from sys import exit

def test_crash(target, my_logger, session, *args, **kwargs):

    banner_template = b"Welcome to Vulnerable Server! Enter HELP for help."
    
    try:
        banner = target.recv(1024)
    except:
        print("Target seems down. Exiting...")
        exit(1)

    my_logger.log_check("Receiving banner ...")
    if banner_template in banner:
        my_logger.log_pass("Banner received.")
    else:
        my_logger.log_fail("No banner received.")
        print("No banner received. Exiting...")
        exit(1)


def main():

    host = "192.168.88.129"
    port = 9999

    csv_log = open('fuzz_logger.csv', 'w')
    my_logger = [FuzzLoggerCsv(file_handle=csv_log)]

    session = Session(
            target = Target(
                connection = TCPSocketConnection(host,port)), fuzz_loggers=my_logger)

    s_initialize("GMON")
    s_string("GMON", fuzzable=False)
    s_delim(" ", fuzzable=False)
    s_string("pajdnkladhnakd")
    s_static("\r\n")

    session.connect(s_get("GMON"), callback=test_crash)
    session.fuzz()

if __name__ == "__main__":
    main()
    
